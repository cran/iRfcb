<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>iRfcb Introduction</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">iRfcb Introduction</h1>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>The <code>iRfcb</code> package is an open-source R package designed
to streamline the analysis of Imaging FlowCytobot (IFCB) data, with a
focus on supporting marine ecological research and monitoring. By
integrating R and Python functionalities, the package facilitates
efficient handling and sharing of IFCB image data, extraction of key
metadata, and preparation of outputs for further taxonomic, ecological,
or spatial analyses.</p>
<p>This tutorial serves as an introduction to the core functionalities
of <code>iRfcb</code>, providing step-by-step instructions for data
preprocessing, taxonomic analysis, and SHARK-compliant data export. For
additional guides—such as quality control of IFCB data, data sharing,
and integration with MATLAB—please refer to the other tutorials
available on the project’s <a href="https://europeanifcbgroup.github.io/iRfcb/">webpage</a>.</p>
</div>
<div id="getting-started" class="section level2">
<h2>Getting Started</h2>
<div id="installation" class="section level3">
<h3>Installation</h3>
<p>You can install the package from CRAN using:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;iRfcb&quot;</span>)</span></code></pre></div>
<p>Load the <code>iRfcb</code> and <code>dplyr</code> libraries:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(iRfcb)</span></code></pre></div>
</div>
<div id="download-sample-data" class="section level3">
<h3>Download Sample Data</h3>
<p>To get started, download sample data from the <a href="https://doi.org/10.17044/scilifelab.25883455.v3">SMHI IFCB
Plankton Image Reference Library</a> (Torstensson et al. 2024) with the
following function:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Define data directory</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>data_dir <span class="ot">&lt;-</span> <span class="st">&quot;data&quot;</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># Download and extract test data in the data folder</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="fu">ifcb_download_test_data</span>(<span class="at">dest_dir =</span> data_dir)</span></code></pre></div>
<pre><code>## Download and extraction complete.</code></pre>
</div>
</div>
<div id="extract-ifcb-data" class="section level2">
<h2>Extract IFCB Data</h2>
<p>This section demonstrates a selection of general data extraction
tools available in <code>iRfcb</code>.</p>
<div id="extract-timestamps-from-ifcb-sample-filenames" class="section level3">
<h3>Extract Timestamps from IFCB sample Filenames</h3>
<p>Extract timestamps from sample names or filenames:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># Example sample names</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>filenames <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;data/data/2023/D20230314&quot;</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co"># Print filenames</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="fu">print</span>(filenames)</span></code></pre></div>
<pre><code>## [1] &quot;D20230314T001205_IFCB134.adc&quot; &quot;D20230314T001205_IFCB134.hdr&quot;
## [3] &quot;D20230314T001205_IFCB134.roi&quot; &quot;D20230314T003836_IFCB134.adc&quot;
## [5] &quot;D20230314T003836_IFCB134.hdr&quot; &quot;D20230314T003836_IFCB134.roi&quot;</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># Convert filenames to timestamps</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>timestamps <span class="ot">&lt;-</span> <span class="fu">ifcb_convert_filenames</span>(filenames)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co"># Print result</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="fu">print</span>(timestamps)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 8
##   sample     timestamp           date        year month   day time   ifcb_number
##   &lt;chr&gt;      &lt;dttm&gt;              &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;time&gt; &lt;chr&gt;      
## 1 D20230314… 2023-03-14 00:12:05 2023-03-14  2023     3    14 12&#39;05&quot; IFCB134    
## 2 D20230314… 2023-03-14 00:12:05 2023-03-14  2023     3    14 12&#39;05&quot; IFCB134    
## 3 D20230314… 2023-03-14 00:12:05 2023-03-14  2023     3    14 12&#39;05&quot; IFCB134    
## 4 D20230314… 2023-03-14 00:38:36 2023-03-14  2023     3    14 38&#39;36&quot; IFCB134    
## 5 D20230314… 2023-03-14 00:38:36 2023-03-14  2023     3    14 38&#39;36&quot; IFCB134    
## 6 D20230314… 2023-03-14 00:38:36 2023-03-14  2023     3    14 38&#39;36&quot; IFCB134</code></pre>
<p>If the filename includes ROI numbers (e.g., in an extracted
<code>.png</code> image), a separate column, <code>roi</code>, will be
added to the output.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># Example sample names</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>filenames <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;data/png/Alexandrium_pseudogonyaulax_050&quot;</span>)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co"># Print filenames</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="fu">print</span>(filenames)</span></code></pre></div>
<pre><code>## [1] &quot;D20220712T210855_IFCB134_00042.png&quot; &quot;D20220712T210855_IFCB134_00164.png&quot;
## [3] &quot;D20220712T222710_IFCB134_00044.png&quot;</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Convert filenames to timestamps</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>timestamps <span class="ot">&lt;-</span> <span class="fu">ifcb_convert_filenames</span>(filenames)</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co"># Print result</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="fu">print</span>(timestamps)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 9
##   sample   timestamp           date        year month   day time     ifcb_number
##   &lt;chr&gt;    &lt;dttm&gt;              &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;time&gt;   &lt;chr&gt;      
## 1 D202207… 2022-07-12 21:08:55 2022-07-12  2022     7    12 21:08:55 IFCB134    
## 2 D202207… 2022-07-12 21:08:55 2022-07-12  2022     7    12 21:08:55 IFCB134    
## 3 D202207… 2022-07-12 22:27:10 2022-07-12  2022     7    12 22:27:10 IFCB134    
## # ℹ 1 more variable: roi &lt;int&gt;</code></pre>
</div>
<div id="calculate-volume-analyzed-in-ml" class="section level3">
<h3>Calculate Volume Analyzed in ml</h3>
<p>The analyzed volume of a sample can be calculated using data from
<code>.hdr</code> and <code>.adc</code> files.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># Path to HDR file</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>hdr_file <span class="ot">&lt;-</span> <span class="st">&quot;data/data/2023/D20230314/D20230314T001205_IFCB134.hdr&quot;</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co"># Calculate volume analyzed (in ml)</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>volume_analyzed <span class="ot">&lt;-</span> <span class="fu">ifcb_volume_analyzed</span>(hdr_file)</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co"># Print result</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="fu">print</span>(volume_analyzed)</span></code></pre></div>
<pre><code>## [1] 4.568676</code></pre>
</div>
<div id="get-sample-runtime" class="section level3">
<h3>Get Sample Runtime</h3>
<p>Get the runtime from a <code>.hdr</code> file:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># Get runtime from HDR-file</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>run_time <span class="ot">&lt;-</span> <span class="fu">ifcb_get_runtime</span>(hdr_file)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co"># Print result</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="fu">print</span>(run_time)</span></code></pre></div>
<pre><code>## $runtime
## [1] 1200.853
## 
## $inhibittime
## [1] 104.3704</code></pre>
</div>
<div id="read-feature-data" class="section level3">
<h3>Read Feature Data</h3>
<p>Read all feature files (<code>.csv</code>) from a folder:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># Read feature files from a folder</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>features <span class="ot">&lt;-</span> <span class="fu">ifcb_read_features</span>(<span class="st">&quot;data/features/2023/&quot;</span>,</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>                               <span class="at">verbose =</span> <span class="cn">FALSE</span>) <span class="co"># Do not print progress bar</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="co"># Print output from the first sample in the list</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="fu">print</span>(features[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>## # A tibble: 1,218 × 237
##    roi_number  Area Biovolume BoundingBox_xwidth BoundingBox_ywidth ConvexArea
##         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;      &lt;dbl&gt;
##  1          2   446     6083.                 31                 21        542
##  2          3  4326   142783.                111                 63       5186
##  3          4  9739   336908.                202                129      10581
##  4          5   580     9187.                 27                 28        602
##  5          6  3927   120367.                 99                 50       4191
##  6          7   290     3112.                 22                 20        335
##  7          8  4437   183891.                 90                 62       4894
##  8          9   576     9297.                 27                 29        605
##  9         10   540     7712.                 28                 25        564
## 10         11   990    18779.                 53                 31       1197
## # ℹ 1,208 more rows
## # ℹ 231 more variables: ConvexPerimeter &lt;dbl&gt;, Eccentricity &lt;dbl&gt;,
## #   EquivDiameter &lt;dbl&gt;, Extent &lt;dbl&gt;, FeretDiameter &lt;dbl&gt;, H180 &lt;dbl&gt;,
## #   H90 &lt;dbl&gt;, Hflip &lt;dbl&gt;, MajorAxisLength &lt;dbl&gt;, MinorAxisLength &lt;dbl&gt;,
## #   Orientation &lt;dbl&gt;, Perimeter &lt;dbl&gt;, RWcenter2total_powerratio &lt;dbl&gt;,
## #   RWhalfpowerintegral &lt;dbl&gt;, Solidity &lt;dbl&gt;, moment_invariant1 &lt;dbl&gt;,
## #   moment_invariant2 &lt;dbl&gt;, moment_invariant3 &lt;dbl&gt;, …</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># Read only multiblob feature files</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>multiblob_features <span class="ot">&lt;-</span> <span class="fu">ifcb_read_features</span>(<span class="st">&quot;data/features/2023&quot;</span>, </span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>                                         <span class="at">multiblob =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>                                         <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="co"># Print output from the first sample in the list</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="fu">print</span>(multiblob_features[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>## # A tibble: 26 × 22
##    roi_number blob_number  Area MajorAxisLength MinorAxisLength Eccentricity
##         &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;        &lt;dbl&gt;
##  1        154           1  3647           110.             45.0        0.912
##  2        154           2  1626            77.5            30.7        0.918
##  3        214           1  7456           232.            123.         0.849
##  4        214           2  4840           102.             68.3        0.741
##  5        214           3   910            54.2            28.5        0.850
##  6        214           4   153            19.0            10.9        0.817
##  7        447           1 29964           808.             64.7        0.997
##  8        447           2   668            77.4            34.3        0.896
##  9        537           1  2989            65.1            59.1        0.419
## 10        537           2  2978            63.5            60.1        0.323
## # ℹ 16 more rows
## # ℹ 16 more variables: Orientation &lt;dbl&gt;, ConvexArea &lt;dbl&gt;,
## #   EquivDiameter &lt;dbl&gt;, Solidity &lt;dbl&gt;, Extent &lt;dbl&gt;, Perimeter &lt;dbl&gt;,
## #   ConvexPerimeter &lt;dbl&gt;, FeretDiameter &lt;dbl&gt;, BoundingBox_xwidth &lt;dbl&gt;,
## #   BoundingBox_ywidth &lt;dbl&gt;, shapehist_mean_normEqD &lt;dbl&gt;,
## #   shapehist_mode_normEqD &lt;dbl&gt;, shapehist_median_normEqD &lt;dbl&gt;,
## #   shapehist_skewness_normEqD &lt;dbl&gt;, shapehist_kurtosis_normEqD &lt;dbl&gt;, …</code></pre>
</div>
</div>
<div id="extract-images-from-roi-files" class="section level2">
<h2>Extract Images from ROI files</h2>
<p>IFCB images stored in <code>.roi</code> files can be extracted as
<code>.png</code> files using the <code>iRfcb</code> package, as
demonstrated below.</p>
<p>Extract all images from a sample using the
<code>ifcb_extract_pngs()</code> function. You can specify the
<code>out_folder</code>, but by default, images will be saved in a
subdirectory within the same directory as the ROI file. The
<code>gamma</code> can be adjusted to enhance image contrast, and an
optional scale bar can be added by specifying
<code>scale_bar_um</code>.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co"># All ROIs in sample</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="fu">ifcb_extract_pngs</span>(</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>  <span class="st">&quot;data/data/2023/D20230314/D20230314T001205_IFCB134.roi&quot;</span>,</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>  <span class="at">gamma =</span> <span class="dv">1</span>, <span class="co"># Default gamma value</span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>  <span class="at">scale_bar_um =</span> <span class="dv">5</span> <span class="co"># Add a 5 micrometer scale bar</span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>) </span></code></pre></div>
<pre><code>## Writing 1218 ROIs from D20230314T001205_IFCB134.roi to data/data/2023/D20230314/D20230314T001205_IFCB134</code></pre>
<p>Extract specific ROIs:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="co"># Only ROI number 2 and 5</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="fu">ifcb_extract_pngs</span>(<span class="st">&quot;data/data/2023/D20230314/D20230314T003836_IFCB134.roi&quot;</span>,</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>                  <span class="at">ROInumbers =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>))</span></code></pre></div>
<pre><code>## Writing 2 ROIs from D20230314T003836_IFCB134.roi to data/data/2023/D20230314/D20230314T003836_IFCB134</code></pre>
<p>To extract annotated images or classified results from MATLAB files,
please see the <code>vignette(&quot;image-export-tutorial&quot;)</code> and
<code>vignette(&quot;matlab-tutorial&quot;)</code> tutorials.</p>
</div>
<div id="taxonomical-data" class="section level2">
<h2>Taxonomical Data</h2>
<p>Maintaining up-to-date taxonomic data is essential for ensuring
accurate species names and classifications, which directly impact
calculations like carbon concentrations in <code>iRfcb</code>.</p>
<p>Up-to-date taxonomy also ensures data harmonization by preventing
issues like misspellings, outdated synonyms, or inconsistent
classifications. This consistency is crucial for integrating and
comparing datasets across studies, regions, and time periods, improving
the reliability of scientific outcomes.</p>
<div id="taxon-matching-with-worms" class="section level3">
<h3>Taxon matching with WoRMS</h3>
<p>Taxonomic names can be matched against the <a href="https://www.marinespecies.org/">World Register of Marine Species
(WoRMS)</a>, ensuring accuracy and consistency. The <code>iRfcb</code>
package includes a built-in function for taxon matching via the WoRMS
API, featuring a retry mechanism to handle server errors, making it
particularly useful for automated data pipelines. For additional tools
and functionality, the R package <a href="https://cran.r-project.org/package=worrms"><code>worrms</code></a>
provides a comprehensive suite of options for interacting with the WoRMS
database.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="co"># Example taxa names</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>taxa_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Alexandrium_pseudogonyaulax&quot;</span>, <span class="st">&quot;Guinardia_delicatula&quot;</span>)</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a><span class="co"># Retrieve WoRMS records</span></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>worms_records <span class="ot">&lt;-</span> <span class="fu">ifcb_match_taxa_names</span>(taxa_names, </span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>                                       <span class="at">verbose =</span> <span class="cn">FALSE</span>) <span class="co"># Do not print progress bar</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a><span class="co"># Print result</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a><span class="fu">print</span>(worms_records)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 29
##   name  AphiaID url   scientificname authority status unacceptreason taxonRankID
##   &lt;chr&gt;   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;          &lt;chr&gt;     &lt;chr&gt;  &lt;lgl&gt;                &lt;int&gt;
## 1 Alex…  109713 http… Alexandrium p… (Biechel… accep… NA                     220
## 2 Guin…  149112 http… Guinardia del… (Cleve) … unass… NA                     220
## # ℹ 21 more variables: rank &lt;chr&gt;, valid_AphiaID &lt;int&gt;, valid_name &lt;chr&gt;,
## #   valid_authority &lt;chr&gt;, parentNameUsageID &lt;int&gt;, originalNameUsageID &lt;int&gt;,
## #   kingdom &lt;chr&gt;, phylum &lt;chr&gt;, class &lt;chr&gt;, order &lt;chr&gt;, family &lt;chr&gt;,
## #   genus &lt;chr&gt;, citation &lt;chr&gt;, lsid &lt;chr&gt;, isMarine &lt;int&gt;, isBrackish &lt;lgl&gt;,
## #   isFreshwater &lt;int&gt;, isTerrestrial &lt;int&gt;, isExtinct &lt;int&gt;, match_type &lt;chr&gt;,
## #   modified &lt;chr&gt;</code></pre>
</div>
<div id="check-whether-a-class-name-is-a-diatom" class="section level3">
<h3>Check whether a class name is a diatom</h3>
<p>This function takes a list of taxa names, cleans them, retrieves
their corresponding classification records from WoRMS, and checks if
they belong to the specified diatom class. The function only uses the
first name (genus name) of each taxa for classification. This function
can be useful for converting biovolumes to carbon according to
Menden-Deuer and Lessard (2000). See <code>vol2C_nondiatom()</code> and
<code>vol2C_lgdiatom()</code> for carbon calculations (not included in
NAMESPACE).</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="co"># Read class2use file and select five taxa</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>class2use <span class="ot">&lt;-</span> <span class="fu">ifcb_get_mat_variable</span>(<span class="st">&quot;data/config/class2use.mat&quot;</span>)[<span class="dv">10</span><span class="sc">:</span><span class="dv">15</span>]</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a><span class="co"># Create a dataframe with class name and result from `ifcb_is_diatom`</span></span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>class_list <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(class2use,</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a>                         <span class="at">is_diatom =</span> <span class="fu">ifcb_is_diatom</span>(class2use, <span class="at">verbose =</span> <span class="cn">FALSE</span>))</span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a><span class="co"># Print rows 10-15 of result</span></span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a><span class="fu">print</span>(class_list)</span></code></pre></div>
<pre><code>##                    class2use is_diatom
## 1        Nodularia_spumigena     FALSE
## 2            Cryptomonadales     FALSE
## 3    Acanthoica_quattrospina     FALSE
## 4 Asterionellopsis_glacialis      TRUE
## 5                  Centrales      TRUE
## 6            Centrales_chain      TRUE</code></pre>
<p>The default class for diatoms is defined as Bacillariophyceae, but
may be adjusted using the <code>diatom_class</code> argument.</p>
</div>
<div id="find-trophic-type-of-plankton-taxa" class="section level3">
<h3>Find trophic type of plankton taxa</h3>
<p>This function takes a list of taxa names and matches them with the
<strong>SMHI Trophic Type</strong> list used in <a href="https://shark.smhi.se/en/">SHARK</a>.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="co"># Example taxa names</span></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>taxa_list <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>  <span class="st">&quot;Acanthoceras zachariasii&quot;</span>,</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>  <span class="st">&quot;Nodularia spumigena&quot;</span>,</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>  <span class="st">&quot;Acanthoica quattrospina&quot;</span>,</span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>  <span class="st">&quot;Noctiluca&quot;</span>,</span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>  <span class="st">&quot;Gymnodiniales&quot;</span></span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>)</span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a><span class="co"># Get trophic type for taxa</span></span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a>trophic_type <span class="ot">&lt;-</span> <span class="fu">ifcb_get_trophic_type</span>(taxa_list)</span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" tabindex="-1"></a><span class="co"># Print result</span></span>
<span id="cb29-14"><a href="#cb29-14" tabindex="-1"></a><span class="fu">print</span>(trophic_type)</span></code></pre></div>
<pre><code>## [1] &quot;AU&quot; &quot;AU&quot; &quot;MX&quot; &quot;HT&quot; &quot;NS&quot;</code></pre>
</div>
</div>
<div id="shark-export" class="section level2">
<h2>SHARK export</h2>
<p>This function is used by SMHI to map IFCB data into the <a href="https://shark.smhi.se/hamta-data/">SHARK</a> standard data
delivery format. An example submission is also provided in
<code>iRfcb</code>.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="co"># Get column names from example</span></span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>shark_colnames <span class="ot">&lt;-</span> <span class="fu">ifcb_get_shark_colnames</span>()</span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a><span class="co"># Print column names</span></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a><span class="fu">print</span>(shark_colnames)</span></code></pre></div>
<pre><code>## # A tibble: 0 × 67
## # ℹ 67 variables: MYEAR &lt;dbl&gt;, STATN &lt;chr&gt;, SAMPLING_PLATFORM &lt;chr&gt;,
## #   PROJ &lt;chr&gt;, ORDERER &lt;chr&gt;, SHIPC &lt;chr&gt;, CRUISE_NO &lt;dbl&gt;, DATE_TIME &lt;dbl&gt;,
## #   SDATE &lt;date&gt;, STIME &lt;time&gt;, TIMEZONE &lt;chr&gt;, LATIT &lt;dbl&gt;, LONGI &lt;dbl&gt;,
## #   POSYS &lt;chr&gt;, WADEP &lt;lgl&gt;, MPROG &lt;chr&gt;, MNDEP &lt;dbl&gt;, MXDEP &lt;dbl&gt;,
## #   SLABO &lt;chr&gt;, ACKR_SMP &lt;chr&gt;, SMTYP &lt;chr&gt;, PDMET &lt;chr&gt;, SMVOL &lt;dbl&gt;,
## #   METFP &lt;chr&gt;, IFCBNO &lt;chr&gt;, SMPNO &lt;chr&gt;, LATNM &lt;chr&gt;, SFLAG &lt;chr&gt;,
## #   LATNM_SFLAG &lt;chr&gt;, TRPHY &lt;chr&gt;, APHIA_ID &lt;dbl&gt;, IMAGE_VERIFICATION &lt;chr&gt;, …</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="co"># Load example stored from `iRfcb`</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>shark_example <span class="ot">&lt;-</span> <span class="fu">ifcb_get_shark_example</span>()</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a><span class="co"># Print the SHARK data submission example</span></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a><span class="fu">print</span>(shark_example)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 67
##   MYEAR STATN          SAMPLING_PLATFORM PROJ  ORDERER SHIPC CRUISE_NO DATE_TIME
##   &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;             &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;    
## 1  2022 RV_FB_D202207… IFCB              IFCB… SMHI    77SE         12 2.02e+15 
## 2  2022 RV_FB_D202207… IFCB              IFCB… SMHI    77SE         12 2.02e+15 
## 3  2022 RV_FB_D202207… IFCB              IFCB… SMHI    77SE         12 2.02e+15 
## 4  2022 RV_FB_D202207… IFCB              IFCB… SMHI    77SE         12 2.02e+15 
## 5  2022 RV_FB_D202207… SveaFB            IFCB… SMHI    77SE         12 2.02e+15 
## # ℹ 59 more variables: SDATE &lt;date&gt;, STIME &lt;time&gt;, TIMEZONE &lt;chr&gt;, LATIT &lt;dbl&gt;,
## #   LONGI &lt;dbl&gt;, POSYS &lt;chr&gt;, WADEP &lt;lgl&gt;, MPROG &lt;chr&gt;, MNDEP &lt;dbl&gt;,
## #   MXDEP &lt;dbl&gt;, SLABO &lt;chr&gt;, ACKR_SMP &lt;chr&gt;, SMTYP &lt;chr&gt;, PDMET &lt;chr&gt;,
## #   SMVOL &lt;dbl&gt;, METFP &lt;chr&gt;, IFCBNO &lt;chr&gt;, SMPNO &lt;chr&gt;, LATNM &lt;chr&gt;,
## #   SFLAG &lt;chr&gt;, LATNM_SFLAG &lt;chr&gt;, TRPHY &lt;chr&gt;, APHIA_ID &lt;dbl&gt;,
## #   IMAGE_VERIFICATION &lt;chr&gt;, VERIFIED_BY &lt;lgl&gt;, COUNT &lt;dbl&gt;, ABUND &lt;dbl&gt;,
## #   BIOVOL &lt;dbl&gt;, C_CONC &lt;dbl&gt;, QFLAG &lt;lgl&gt;, COEFF &lt;dbl&gt;, CLASS_NAME &lt;chr&gt;, …</code></pre>
<p>This concludes this tutorial for the <code>iRfcb</code> package. For
additional guides—such as quality control of IFCB data, data sharing,
and integration with MATLAB—please refer to the other tutorials
available on the project’s <a href="https://europeanifcbgroup.github.io/iRfcb/">webpage</a>. See how
data pipelines can be constructed using <code>iRfcb</code> in the
following <a href="https://github.com/nodc-sweden/ifcb-data-pipeline">Example
Project</a>. Happy analyzing!</p>
</div>
<div id="citation" class="section level2">
<h2>Citation</h2>
<pre><code>## To cite package &#39;iRfcb&#39; in publications use:
## 
##   Anders Torstensson (2026). iRfcb: Tools for Managing Imaging
##   FlowCytobot (IFCB) Data. R package version 0.7.0.
##   https://CRAN.R-project.org/package=iRfcb
## 
## A BibTeX entry for LaTeX users is
## 
##   @Manual{,
##     title = {iRfcb: Tools for Managing Imaging FlowCytobot (IFCB) Data},
##     author = {Anders Torstensson},
##     year = {2026},
##     note = {R package version 0.7.0},
##     url = {https://CRAN.R-project.org/package=iRfcb},
##   }</code></pre>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<ul>
<li>Torstensson, A., Skjevik, A-T., Mohlin, M., Karlberg, M. and
Karlson, B. (2024). SMHI IFCB Plankton Image Reference Library.
SciLifeLab. Dataset. <a href="https://doi.org/10.17044/scilifelab.25883455.v3" class="uri">https://doi.org/10.17044/scilifelab.25883455.v3</a></li>
</ul>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
